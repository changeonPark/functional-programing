<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>5. 실전코드조각-1</title>
    <script src="js/partial.js"></script>
    <script src="js/_.js"></script>
  </head>
  <body>
    <script>
      var userList = [
        { id: 101, name: "ID" },
        { id: 102, name: "BJ" },
        { id: 103, name: "PJ" },
        { id: 104, name: "HA" },
        { id: 105, name: "JE" },
        { id: 106, name: "JI" },
      ]

      var postList = [
        { id: 201, body: "내용1", user_id: 101 },
        { id: 202, body: "내용2", user_id: 102 },
        { id: 203, body: "내용3", user_id: 103 },
        { id: 204, body: "내용4", user_id: 102 },
        { id: 205, body: "내용5", user_id: 101 },
      ]

      var commentList = [
        { id: 301, body: "댓글1", user_id: 105, post_id: 201 },
        { id: 302, body: "댓글2", user_id: 104, post_id: 201 },
        { id: 303, body: "댓글3", user_id: 104, post_id: 202 },
        { id: 304, body: "댓글4", user_id: 105, post_id: 203 },
        { id: 305, body: "댓글5", user_id: 106, post_id: 203 },
        { id: 306, body: "댓글6", user_id: 106, post_id: 204 },
        { id: 307, body: "댓글7", user_id: 102, post_id: 205 },
        { id: 308, body: "댓글8", user_id: 103, post_id: 204 },
        { id: 309, body: "댓글9", user_id: 103, post_id: 202 },
        { id: 310, body: "댓글10", user_id: 105, post_id: 201 },
      ]

      // 1. 특정인의 postList의 모든 commentList 거르기
      // postList를 순회하며 user_id의 value가 101인 값 배열로 return
      const postsBy = (attr) => {
        return _.where(postList, attr)
      }

      const commentsByPosts = _.pipe(_.pluck("id"), (postIds) => {
        return _.filter(commentList, (comment) => {
          return _.contains(postIds, comment.post_id)
        })
      })

      const f1 = _.pipe(postsBy, commentsByPosts)

      // _.go({ user_id: 101 }, f1, console.log)
      console.log(f1({ user_id: 101 }))

      // 2. 특정인의 postList에 comment를 단 친구의 이름들 뽑기
      const commentsToUserNames = _.map((comment) => {
        return _.find(userList, (user) => user.id === comment.user_id).name
      })

      const f2 = _.pipe(f1, commentsToUserNames, _.uniq)

      console.log(f2({ user_id: 101 }))

      // _.go(
      //   { user_id: 101 },
      //   postsBy,
      //   commentsByPosts,
      //   _.map((comment) => {
      //     return _.find(userList, (user) => user.id === comment.user_id).name
      //   }),
      //   // 중복 제거
      //   _.uniq,
      //   console.log
      // )

      // 3. 특정인의 posts에 commentList를 단 친구들 카운트 정보

      const f3 = _.pipe(f1, commentsToUserNames, _.count_by)

      console.log(f3({ user_id: 101 }))

      // _.go(
      //   { user_id: 101 },
      //   postsBy,
      //   commentsByPosts,
      //   _.map((comment) => {
      //     return _.find(userList, (user) => user.id === comment.user_id).name
      //   }),
      //   // 중복 제거
      //   _.count_by,
      //   console.log
      // )

      // 4. 특정인이 comment를 단 postList 거르기

      _.go(
        _.where(commentList, { user_id: 105 }),
        _.pluck("post_id"),
        _.uniq,
        (postIds) => {
          return _.filter(postList, (post) => {
            return _.contains(postIds, post.id)
          })
        },
        console.log
      )
    </script>
  </body>
</html>
